{% extends "base.html" %}
{% block title %}{{ accion.capitalize() }}{% endblock %}
{% block contenido %}
<div class="container">
    <h2 class="titulo">{{ accion.capitalize() }} de productos</h2>

    <form method="get" class="form-filtros">
        <input type="text" name="q" placeholder="Buscar por nombre o c√≥digo..." value="{{ query }}" class="input-text">
        <select name="tipo" class="input-select">
            <option value="">Todos los tipos</option>
            {% for t in tipos %}
            <option value="{{ t }}" {% if tipo_filtro == t %}selected{% endif %}>{{ t|capitalize }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-buscar">üîç Buscar</button>
    </form>

    <div class="tabla-container">
        <table class="tabla">
            <thead>
                <tr>
                    <th>Nombre</th><th>C√≥digo</th><th>Cantidad</th><th>Precio</th><th>Tipo</th><th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody>
            {% for p in productos %}
                <tr>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.codigo }}</td>
                    <td>{{ p.cantidad }}</td>
                    <td>${{ "%.2f"|format(p.precio) }}</td>
                    <td>{{ p.tipo }}</td>
                    <td>
                        <form method="post" class="inline-form">
                            <input type="hidden" name="codigo" value="{{ p.codigo }}">
                            <input type="number" name="cantidad" value="1" min="1" class="input-mini" required>
                            {% if accion == "devolucion" %}
                            <input type="text" name="descripcion" placeholder="Motivo..." class="input-text">
                            {% endif %}
                            <button type="submit" class="btn-mini">‚ûï</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if carrito %}
    <h3 class="subtitulo">Productos agregados</h3>
    <div class="tabla-container">
        <table class="tabla">
            <thead>
                <tr>
                    <th>Nombre</th><th>C√≥digo</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th>
                    {% if accion == "devolucion" %}<th>Descripci√≥n</th>{% endif %}
                </tr>
            </thead>
            <tbody>
            {% for i in carrito %}
                <tr>
                    <td>{{ i.nombre }}</td>
                    <td>{{ i.codigo }}</td>
                    <td>{{ i.cantidad }}</td>
                    <td>${{ "%.2f"|format(i.precio) }}</td>
                    <td>${{ "%.2f"|format(i.precio * i.cantidad) }}</td>
                    {% if accion == "devolucion" %}
                    <td>{{ i.descripcion }}</td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <p class="total"><strong>Total:</strong> ${{ "%.2f"|format(total) }}</p>

    <form method="post">
        <button type="submit" name="finalizar" class="btn-accion-final">‚úÖ Finalizar {{ accion }}</button>
    </form>
    {% endif %}

    <a href="{{ url_for('flujo_productos') }}" class="btn-volver">‚¨ÖÔ∏è Volver al flujo</a>
</div>
{% endblock %}
